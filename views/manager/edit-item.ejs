<%- include('../shared/head.ejs') %>
<link rel="stylesheet" href="/css/manager.css">
<link rel="stylesheet" href="/css/nav.css">
</head>
<body>
<%- include('../shared/nav.ejs') %>
<main>
    <div class="form-container">
        <h2><%= docTitle %></h2>
        <form id="add-item-form" class="add-item-form" method="POST" 
            action="/manager/<% if(editing) { %>edit-item<% } else { %>add-item<% } %>">
            <label class="form__label" for="title">Title</label>
            <input type="text" class="form__input" name="title" 
                <% if(editing) { %> value="<%= item.title %>" <% } %>/>
            <label class="form__label" for="price">Price</label>
            <input type="number" step="0.01" class="form__input" name="price" 
                <% if(editing) { %> value="<%= item.price %>" <% } %>/>
            <label class="form__label" for="description">Description</label>
            <textarea class="form__textarea" rows="5" name="description"><% if(editing) { %><%= item.description %><% } %></textarea>
            <label class="form__label" for="imagePath">Image Path</label>
            <input type="text" class="form__input" name="imagePath" 
                <% if(editing) { %> value="<%= item.imagePath %>" <% } %>/>
            <div class="ingredients__container">
                <% for( let i=0; i<ingRows; i++) { %>
                    <div class="ingredient__select">
                        <div class="form__group form__group--select">
                            <label class="form__label" for="ingredients[<%= i %>][title]">Ingredients</label>
                            <select class="form__select" name="ingredients[<%= i %>][title]">
                                <option selected><% if(editing) { %><%= item.recipe[i].title %><% } else { %>**Select Ingredient**<% } %></option>
                                <% ingredients.forEach(ing => { %>
                                    <option><%= ing.title %></option>
                                <% }) %>
                            </select>
                        </div>
                        <div class="form__group form__group--qty">
                            <label class="form__label" for="ingredients[<%= i %>][qty]">Qty</label>
                            <input type="number" class="form__input form__input--qty" 
                                <% if(editing) { %> value="<%=item.recipe[i].qty %>" <% } %>
                                name="ingredients[<%= i %>][qty]"/>
                        </div>
                    </div>
                <% } %>
            </div>
            <button type="button" class="btn__add-row" onclick="addRows()">Add more...</button>
            <% if(editing) { %>
                <input type="hidden" name="id" value="<%= item._id %>" />
            <% } %>
            <button class="btn btn--submit" type="submit"><% if(editing) { %>Update <% } else { %>Add <% } %> Menu Item</button>
        </form>
    </div>
</main>

<%- include('../shared/end.ejs') %>

<script>
    let curIndex = '<%= ingRows %>';
    function addRows(){
        const ingContainer = document.querySelector('.ingredients__container');

        const html = `
        <div class="ingredient__select">
            <div class="form__group form__group--select">
                <label class="form__label" for="ingredients[${curIndex}][title]">Ingredients</label>
                <select class="form__select" name="ingredients[${curIndex}][title]">
                    <option selected>**Select Ingredient**</option>
                    <% ingredients.forEach(ing => { %>
                        <option><%= ing.title %></option>
                    <% }) %>
                </select>
            </div>
            <div class="form__group form__group--qty">
                <label class="form__label" for="ingredients[${curIndex}][qty]">Qty</label>
                <input type="number" class="form__input form__input--qty" name="ingredients[${curIndex}][qty]"/>
            </div>
        </div>
        `;
        curIndex++;

        ingContainer.insertAdjacentHTML('beforeend', html);
    }
</script>

